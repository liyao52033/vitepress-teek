---
date: 2025-08-24 12:40:01
title: 配置algolia
permalink: /pages/20b6a7
description: '本文系统讲解了如何配置Algolia搜索服务，包括注册账号、创建应用、建立索引、验证域名、配置爬虫并启动爬取，以及设置索引和筛选条件，最后介绍了前端代码的集成方法。通过这些步骤，用户能够实现网站内容的高效搜索功能，提升用户体验。'
author:
  name: 华总
  link: https://xiaoying.org.cn
categories:
  - 工具类
  - 本站插件
---

## 1、注册账号

首先需要去 [algolia](https://www.algolia.com/) 官网注册自己的账号，可以直接使用 Github 或者其他邮箱注册登录。

新账号会自动创建一个*Application* ，也可以自己创建一个新的

![image-20250824130816421](https://img.xiaoying.org.cn/img/20250824130816604.png)

![image-20250824130142558](https://img.xiaoying.org.cn/img/20250824130142740.png)

点击确定后接着下一个页面继续点击`create Application`按钮，然后点击`NEXT`就创建了一个新的Application，创建完成后点击
`Skip for now`，不然会根据域名生成index名称，爬虫配置也不对
![image-20250824130516564](https://img.xiaoying.org.cn/img/20250824130516767.png)

## 2、新建index

按下图步骤创建index

![image-20250824131152530](https://img.xiaoying.org.cn/img/20250824131152726.png)

## 3、验证域名

按要求验证域名
![image-20250824131514561](https://img.xiaoying.org.cn/img/20250824131514756.png)

然后点击`Skip for now`进行下一步骤

## 4、配置爬虫

按下图所示新建爬虫

![image-20250824133254539](https://img.xiaoying.org.cn/img/20250824133254740.png)

新建后点击爬虫名称进入爬虫配置

![image-20250824135124409](https://img.xiaoying.org.cn/img/20250824135124624.png)

爬虫配置如下，将`域名`和`indexName`改成自己配置的，配置完成后点击右上角`start Crawling`开始爬取网站内容

```js
new Crawler({
  appId: "...",
  apiKey: "...",
  rateLimit: 8,
  startUrls: ["https://vp.xiaoying.org.cn/"],
  renderJavaScript: false,
  sitemaps: ["https://vp.xiaoying.org.cn/sitemap.xml"],
  exclusionPatterns: ["https://vp.xiaoying.org.cn/config/theme"],
  ignoreCanonicalTo: false,
  discoveryPatterns: ["https://vp.xiaoying.org.cn/**"],
  schedule: "on the first day of the month",
  actions: [
    {
      indexName: "blog",
      pathsToMatch: ["https://vp.xiaoying.org.cn/**"],
      recordExtractor: ({ url, $, helpers }) => {
        const docRecords = helpers.docsearch({
          recordProps: {
            lvl0: {
              selectors: "section.has-active div h2",
              defaultValue: "Documentation",
            },
            lvl1: ".content h1",
            lvl2: ".content h2",
            lvl3: ".content h3",
            content: ".content p, .content li",
          },
          indexHeadings: true,
          recordVersion: "v3",
        });

        const processedRecords = docRecords.map((record) => {
          if (!record.lvl2 && record.hierarchy && record.hierarchy.lvl2) {
            return { ...record, lvl2: record.hierarchy.lvl2 };
          }
          if (!record.lvl3 && record.hierarchy && record.hierarchy.lvl3) {
            return { ...record, lvl3: record.hierarchy.lvl3 };
          }
          return record;
        });

        // 映射锚点
        return processedRecords.map((record) => {
          const $content = $(".content");
          let anchor = "";

          // 1. 优先用 lvl2 匹配标题
          if (record.lvl2) {
            const $heading = $content
              .find(`h2:contains('${record.lvl2}')`)
              .first();
            anchor = $heading.attr("id") || anchor;
          }

          // 2. lvl2 无匹配时，用 lvl3 匹配
          if (!anchor && record.lvl3) {
            const $heading = $content
              .find(`h3:contains('${record.lvl3}')`)
              .first();
            anchor = $heading.attr("id") || anchor;
          }

          // 3. 兜底：用 content 匹配，基于 DOM 顺序选最近的锚点
          if (!anchor && record.content) {
            // 收集所有标题锚点
            const headingMap = new Map();
            $content.find("h2[id], h3[id]").each((index, heading) => {
              headingMap.set(index, $(heading).attr("id") || "");
            });
            const headingsCount = headingMap.size;
            if (headingsCount === 0) {
              anchor = "";
            } else {
              // 找内容所在元素的索引
              let contentIndex = -1;
              $content.find("*").each((index, elem) => {
                if ($(elem).text().includes(record.content)) {
                  contentIndex = index;
                  return false;
                }
              });

              if (contentIndex === -1) {
                // 无内容匹配，用第一个标题
                anchor = headingMap.get(0) || "";
              } else {
                // 计算最近标题
                let minDistance = Infinity;
                let closestAnchor = "";
                $content.find("h2[id], h3[id]").each((_, heading) => {
                  let headingIndexInDOM = -1;
                  $content.find("*").each((index, elem) => {
                    if (elem === heading) {
                      headingIndexInDOM = index;
                      return false;
                    }
                  });
                  if (headingIndexInDOM === -1) return;

                  const distance = Math.abs(headingIndexInDOM - contentIndex);
                  if (distance < minDistance) {
                    minDistance = distance;
                    closestAnchor = $(heading).attr("id") || "";
                  }
                });
                anchor = closestAnchor;
              }
            }
          }

          return {
            ...record,
            anchor: anchor,
            url: anchor ? `${url}#${anchor}` : url,
          };
        });
      },
    },
  ],
  initialIndexSettings: {
    blog: {
      attributesForFaceting: ["type", "lang"],
      attributesToRetrieve: ["hierarchy", "content", "anchor", "url"],
      attributesToHighlight: ["hierarchy", "hierarchy_camel", "content"],
      attributesToSnippet: ["content:10"],
      camelCaseAttributes: ["hierarchy", "hierarchy_radio", "content"],
      searchableAttributes: [
        "unordered(hierarchy_radio_camel.lvl0)",
        "unordered(hierarchy_radio.lvl0)",
        "unordered(hierarchy_radio_camel.lvl1)",
        "unordered(hierarchy_radio.lvl1)",
        "unordered(hierarchy_radio_camel.lvl2)",
        "unordered(hierarchy_radio.lvl2)",
        "unordered(hierarchy_radio_camel.lvl3)",
        "unordered(hierarchy_radio.lvl3)",
        "unordered(hierarchy_radio_camel.lvl4)",
        "unordered(hierarchy_radio.lvl4)",
        "unordered(hierarchy_radio_camel.lvl5)",
        "unordered(hierarchy_radio.lvl5)",
        "unordered(hierarchy_radio_camel.lvl6)",
        "unordered(hierarchy_radio.lvl6)",
        "unordered(hierarchy_camel.lvl0)",
        "unordered(hierarchy.lvl0)",
        "unordered(hierarchy_camel.lvl1)",
        "unordered(hierarchy.lvl1)",
        "unordered(hierarchy_camel.lvl2)",
        "unordered(hierarchy.lvl2)",
        "unordered(hierarchy_camel.lvl3)",
        "unordered(hierarchy.lvl3)",
        "unordered(hierarchy_camel.lvl4)",
        "unordered(hierarchy.lvl4)",
        "unordered(hierarchy_camel.lvl5)",
        "unordered(hierarchy.lvl5)",
        "unordered(hierarchy_camel.lvl6)",
        "unordered(hierarchy.lvl6)",
        "content",
      ],
      distinct: true,
      attributeForDistinct: "url",
      customRanking: [
        "desc(weight.pageRank)",
        "desc(weight.level)",
        "asc(weight.position)",
      ],
      ranking: [
        "words",
        "filters",
        "typo",
        "attribute",
        "proximity",
        "exact",
        "custom",
      ],
      highlightPreTag: '<span class="algolia-docsearch-suggestion--highlight">',
      highlightPostTag: "</span>",
      minWordSizefor1Typo: 3,
      minWordSizefor2Typos: 7,
      allowTyposOnNumericTokens: false,
      minProximity: 1,
      ignorePlurals: true,
      advancedSyntax: true,
      attributeCriteriaComputedByMinProximity: true,
      removeWordsIfNoResults: "allOptional",
    },
  },
});
```

## 5、索引设置

回到搜索页面看是否有数据

![image-20250824134034515](https://img.xiaoying.org.cn/img/20250824134034744.png)

接着配置索引，选择要搜索的内容

![image-20250824134400340](https://img.xiaoying.org.cn/img/20250824134400554.png)

接着配置facets，这是实现高级搜索和筛选功能的核心特性之一，主要作用是帮助用户快速缩小搜索范围，提升搜索体验，这里要重点注意
`lang`必须被选择，否则网页搜索为空

![image-20250824134630115](https://img.xiaoying.org.cn/img/20250824134630329.png)

## 6、代码配置

按图所示找到下面的配置

![image-20250824135518386](https://img.xiaoying.org.cn/img/20250824135518604.png)

![image-20250824135844855](https://img.xiaoying.org.cn/img/20250824135845066.png)

![image-20250824135939156](https://img.xiaoying.org.cn/img/20250824135939358.png)

```ts
export default defineConfig({
   ...
    lang: "zh-CN",
   ...
    themeConfig: ({
      ...
        search: {
            provider: 'algolia',
            options: {
                appId: '...',
                apiKey: '...',
                indexName: '...'
            },
        } 
      ...
    })
})

```



